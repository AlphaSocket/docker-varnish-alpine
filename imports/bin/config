#!/bin/sh

# exit if a command fails
set -e

# Setup folder
echo "### Setup folder..."
mkdir -p $CONFIG_VARNISH_WORKING_DIR && chown $CONFIG_VARNISH_USER $CONFIG_VARNISH_WORKING_DIR

# Create server conf
echo "### Create server conf..."
mkdir -p $(dirname $CONFIG_PATHS_CONF_VARNISH_SERVER)
envsubst < $CONFIG_PATHS_TEMPLATES_VARNISH_SERVER > $CONFIG_PATHS_CONF_VARNISH_SERVER
ls $CONFIG_PATHS_CONF_VARNISH_SERVER

# Append control panel option if enabled
echo "### Append control panel option if enabled..."
if [ "$CONFIG_VARNISH_CONTROL_PANEL_ENABLED" = "$GENERAL_KEYS_TRUE" ]; then
    export CONFIG_VARNISH_STARTUP_OPTIONS="$CONFIG_VARNISH_STARTUP_OPTIONS $CONFIG_VARNISH_CONTROL_PANEL_STARTUP_OPTIONS";
fi


exit 0