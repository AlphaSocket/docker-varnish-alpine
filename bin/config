#!/bin/sh

# exit if a command fails
set -e

# Setup folder
mkdir -p $CONFIG_VARNISH_WORKING_DIR && chown $CONFIG_VARNISH_USER $CONFIG_VARNISH_WORKING_DIR

# Append control panel option if enabled
if [ "$BUILD_VARNISH_CONTROL_PANEL_ENABLED" = "$GENERAL_KEYS_TRUE" ]; then
    CONFIG_PATHS_CONF_VARNISH_SERVER="$CONFIG_PATHS_CONF_VARNISH_SERVER $CONFIG_VARNISH_CONTROL_PANEL_STARTUP_OPTIONS";
fi
# Create server conf
envsubst < $CONFIG_PATHS_TEMPLATES_VARNISH_SERVER > $CONFIG_PATHS_CONF_VARNISH_SERVER



exit 0