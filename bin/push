#!/bin/sh
#
# Script that retag and push test docker images to prd user
#

# exit if a command fails
set -e

DOCKER=$(which docker)

if [ DOCKER = '' ]; then
    echo 'Docker is required\n'
    exit 1
fi

#
# LOGIN
#
if [ ! -z "$DOCKER_PASSWORD" ] ;
then
    # Automated push
    docker login -u "alphasocket" -p "$DOCKER_PASSWORD" docker.io;
else
    docker login -u "alphasocket" docker.io;
fi

#
# RE-TAG the dev image to prd usr
#
docker tag 03192859189254/varnish-alpine:latest \
    alphasocket/varnish-alpine:latest;

#
# PUSH
#
echo "#\n# Pushing image\n#\n"
docker push docker.io/alphasocket/varnish-alpine:latest;
exit $?